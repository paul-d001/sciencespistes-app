<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><title>SciencesPistes</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Newsreader:opsz,wght@6..72,400;6..72,600&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}:root{--bg:#faf9f7;--wh:#fff;--s1:#f3f1ee;--brd:#e0ddd8;--brd2:#d0cdc7;--t1:#1a1816;--t2:#5c5650;--t3:#8a847d;--t4:#b5afa8;--co:#d94f3b;--cl:#fef0ed;--cd:#b83d2d;--gn:#2a9d6b;--gl:#edf8f3;--am:#d4930a;--al:#fef8e7;--bl:#3b7dd9;--bll:#edf3fe;--r:14px;--rs:10px;--sh:0 1px 3px rgba(0,0,0,.04),0 4px 12px rgba(0,0,0,.06);--sh2:0 4px 16px rgba(0,0,0,.08),0 12px 40px rgba(0,0,0,.1)}body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}a{color:var(--co);text-decoration:none;font-weight:600}
#LS{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;background:linear-gradient(160deg,#faf9f7,#f0ece6)}.lbox{width:100%;max-width:400px;background:var(--wh);border-radius:20px;padding:44px 32px;box-shadow:var(--sh2);text-align:center}.llogo{font-family:'Newsreader',serif;font-size:28px;font-weight:600;margin-bottom:4px}.llogo-sciences{color:var(--t1)}.llogo-pistes{color:var(--co);text-decoration:underline;text-decoration-color:var(--co);text-decoration-thickness:2px;text-underline-offset:4px}.lsub{font-size:14px;color:var(--t3);margin-bottom:28px}.lin{width:100%;padding:14px 18px;border:1.5px solid var(--brd);border-radius:var(--rs);font:400 15px 'Outfit',sans-serif;color:var(--t1);background:var(--s1);outline:none;margin-bottom:12px;transition:.2s}.lin:focus{border-color:var(--co);background:var(--wh)}.lbtn{width:100%;padding:14px;border:none;border-radius:var(--rs);font:600 15px 'Outfit',sans-serif;color:#fff;background:var(--co);cursor:pointer;transition:.2s;margin-top:4px}.lbtn:hover{background:var(--cd)}.lbtn:active{transform:scale(.97)}.lhi{font-size:12px;color:var(--t4);margin-top:14px}.ldemo{display:flex;gap:12px;justify-content:center;margin-top:12px}.ldemo a{font-size:12px;color:var(--co);font-weight:500;cursor:pointer}
.app{display:none;min-height:100vh;padding-bottom:80px}.app.on{display:block}.tb{position:sticky;top:0;z-index:50;background:rgba(250,249,247,.88);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--brd);padding:12px 20px;display:flex;align-items:center;justify-content:space-between}.tbl{font-family:'Newsreader',serif;font-size:20px;font-weight:600}.tbl-sciences{color:var(--t1)}.tbl-pistes{color:var(--co);text-decoration:underline;text-decoration-color:var(--co);text-decoration-thickness:1.5px;text-underline-offset:3px}.tbr{display:flex;align-items:center;gap:8px}.tbrole{font-size:11px;color:var(--t4);background:var(--s1);padding:3px 10px;border-radius:20px}.tbav{width:32px;height:32px;border-radius:50%;background:var(--cl);color:var(--co);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;cursor:pointer}
.bn{position:fixed;bottom:0;left:0;right:0;z-index:50;background:var(--wh);border-top:1px solid var(--brd);display:flex;padding:5px 0 calc(5px + env(safe-area-inset-bottom));box-shadow:0 -2px 10px rgba(0,0,0,.04)}.ni{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:5px 0;cursor:pointer;border:none;background:none;font-family:inherit}.ni svg{width:20px;height:20px;color:var(--t4);transition:.15s}.ni .nl{font-size:9.5px;font-weight:500;color:var(--t4);transition:.15s}.ni.on svg{color:var(--co)}.ni.on .nl{color:var(--co);font-weight:600}.ni:active{transform:scale(.9)}
.pg{display:none;padding:20px;max-width:700px;margin:0 auto}.pg.on{display:block;animation:fu .25s ease}@keyframes fu{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}.pgt{font-family:'Newsreader',serif;font-size:24px;font-weight:600;margin-bottom:4px}.pgs{font-size:13px;color:var(--t3);margin-bottom:18px;line-height:1.5}
.ch{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:500;padding:3px 9px;border-radius:20px}.chl{background:var(--bll);color:var(--bl)}.chs{background:var(--s1);color:var(--t2)}.chf{background:var(--al);color:var(--am)}.chp{background:var(--gl);color:var(--gn);font-weight:600}.chc{background:var(--cl);color:var(--co);font-weight:600}
.cd{background:var(--wh);border:1px solid var(--brd);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;transition:.15s;box-shadow:0 1px 2px rgba(0,0,0,.02)}.cd:hover{border-color:var(--brd2)}.cc{cursor:pointer}.cc:hover{box-shadow:var(--sh);transform:translateY(-1px)}.cc:active{transform:scale(.985)}
.bg{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px}.bgg{background:var(--gl);color:var(--gn)}.bga{background:var(--al);color:var(--am)}.bgx{background:var(--s1);color:var(--t3)}.bgc{background:var(--cl);color:var(--co)}.bgb{background:var(--bll);color:var(--bl)}
.bt{padding:12px 20px;border:none;border-radius:var(--rs);font:600 14px 'Outfit',sans-serif;cursor:pointer;transition:.2s;display:inline-flex;align-items:center;gap:8px;justify-content:center}.bt:active{transform:scale(.97)}.bp{background:var(--co);color:#fff}.bp:hover{background:var(--cd)}.bo{background:none;border:1.5px solid var(--brd);color:var(--t2)}.bo:hover{border-color:var(--co);color:var(--co)}.bf{width:100%}.bs{padding:8px 14px;font-size:13px}.bd{background:none;border:1.5px solid var(--co);color:var(--co)}
.ip{width:100%;padding:11px 14px;border:1.5px solid var(--brd);border-radius:var(--rs);font:400 14px 'Outfit',sans-serif;color:var(--t1);background:var(--wh);outline:none;transition:.2s}.ip:focus{border-color:var(--co)}.il{font-size:12px;font-weight:600;color:var(--t3);margin-bottom:5px;display:block}.ig{margin-bottom:12px}.sl{appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%238a847d' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:38px}textarea.ip{resize:vertical;min-height:70px;line-height:1.5}
.st{font-size:12px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.5px;margin:20px 0 10px;display:flex;align-items:center;gap:8px}.dv{border:none;border-top:1px solid var(--brd);margin:16px 0}
.ov{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.25);backdrop-filter:blur(3px);display:none;align-items:flex-end;justify-content:center}.ov.on{display:flex;animation:fi .15s}@keyframes fi{from{opacity:0}to{opacity:1}}.sh{background:var(--wh);border-radius:20px 20px 0 0;width:100%;max-width:700px;max-height:92vh;overflow-y:auto;padding:20px 22px calc(20px + env(safe-area-inset-bottom));animation:su .25s cubic-bezier(.22,1,.36,1)}@keyframes su{from{transform:translateY(100%)}to{transform:none}}.sha{width:36px;height:4px;background:var(--brd2);border-radius:4px;margin:0 auto 16px}.sht{font-family:'Newsreader',serif;font-size:20px;font-weight:600;margin-bottom:14px}
.dg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px}.di{padding:10px 12px;background:var(--s1);border-radius:var(--rs)}.dll{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:2px}.dvv{font-size:13px;font-weight:500}.df{grid-column:1/-1}
.wb{background:var(--al);border:1px solid rgba(212,147,10,.2);border-radius:var(--rs);padding:12px 14px;font-size:13px;color:var(--am);line-height:1.5;margin-bottom:14px}.wb strong{color:var(--t1)}.ib{background:var(--cl);border:1px solid rgba(217,79,59,.15);border-radius:var(--rs);padding:12px 14px;font-size:13px;line-height:1.5;margin-bottom:14px}
.to{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--t1);color:#fff;padding:12px 22px;border-radius:12px;font-size:13px;font-weight:500;z-index:200;opacity:0;transition:.3s;pointer-events:none;box-shadow:var(--sh2);max-width:90vw;text-align:center}.to.show{opacity:1;transform:translateX(-50%) translateY(0)}
.sr{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;margin-bottom:20px}.sc{background:var(--wh);border:1px solid var(--brd);border-radius:var(--r);padding:14px;text-align:center}.sv{font-family:'Newsreader',serif;font-size:26px;font-weight:600}.slb{font-size:11px;color:var(--t3);margin-top:2px}
.ac{background:var(--cl);border:1px solid rgba(217,79,59,.12);border-radius:var(--r);padding:12px 16px;margin-bottom:8px;display:flex;align-items:center;gap:10px;font-size:13px;cursor:pointer;transition:.15s}.ac:hover{border-color:var(--co)}
.it{display:flex;gap:4px;background:var(--s1);border-radius:var(--rs);padding:3px;margin-bottom:16px}.itb{flex:1;padding:8px 10px;border:none;border-radius:8px;font:500 12px 'Outfit',sans-serif;color:var(--t3);background:none;cursor:pointer;transition:.2s;text-align:center}.itb.on{background:var(--wh);color:var(--t1);box-shadow:0 1px 3px rgba(0,0,0,.06)}
.cb{position:fixed;bottom:70px;right:16px;z-index:40}.cbb{width:48px;height:48px;border-radius:50%;background:var(--co);color:#fff;border:none;box-shadow:var(--sh2);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;font-size:20px}.cbb:hover{transform:scale(1.08)}.cbb:active{transform:scale(.95)}
.vb{background:var(--s1);border:2px dashed var(--brd2);border-radius:var(--r);padding:20px;text-align:center;cursor:pointer;transition:.2s;margin-bottom:14px}.vb:hover{border-color:var(--co);background:var(--cl)}.vb p{font-size:13px;color:var(--t3);line-height:1.5}
.vd{display:inline-flex;align-items:center;gap:4px;font-size:11px;color:var(--bl);font-weight:500}.vd::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--bl)}
.pr{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}.prl{font-size:13px;color:var(--t3)}.prv{font-size:14px;font-weight:500;text-align:right;max-width:60%}
.cbd{position:fixed;inset:0;z-index:110;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}.cbd.on{display:flex}.cbw{background:var(--wh);border-radius:20px;width:95%;max-width:500px;max-height:85vh;overflow-y:auto;display:flex;flex-direction:column}.cbh{padding:20px 20px;border-bottom:1px solid var(--brd);flex-shrink:0}.cbm{flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:12px}.cbm-msg{display:flex;gap:8px;animation:cmf .25s ease}@keyframes cmf{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}.cbm-bot{justify-content:flex-start}.cbm-user{justify-content:flex-end}.cbm-bubble{padding:12px 16px;border-radius:12px;font-size:13px;line-height:1.5;max-width:85%}.cbm-bot .cbm-bubble{background:var(--s1);color:var(--t2);display:flex;align-items:center;gap:8px}.cbm-bot .cbm-bubble::before{content:'SP';width:28px;height:28px;min-width:28px;border-radius:50%;background:var(--co);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px;text-align:center}.cbm-user .cbm-bubble{background:var(--co);color:#fff}.cbm-typing{display:flex;gap:4px;padding:12px 16px;background:var(--s1);border-radius:12px;width:fit-content}.cbm-typing span{width:6px;height:6px;border-radius:50%;background:var(--t3);animation:cbt 1.4s infinite}.cbm-typing span:nth-child(2){animation-delay:.2s}.cbm-typing span:nth-child(3){animation-delay:.4s}@keyframes cbt{0%,60%,100%{opacity:0.5}30%{opacity:1}}
.cbf{padding:15px;border-top:1px solid var(--brd);display:flex;gap:8px;flex-shrink:0}.cbf-i{flex:1}.cbf-b{width:40px;height:40px;border:none;background:var(--co);color:#fff;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:.2s;flex-shrink:0}.cbf-b:hover{background:var(--cd)}.cbf-b:active{transform:scale(.95)}
.cbc{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}.cbc-btn{padding:8px 14px;border:1.5px solid var(--co);background:none;color:var(--co);border-radius:20px;font:500 12px 'Outfit',sans-serif;cursor:pointer;transition:.2s}.cbc-btn:hover{background:var(--cl)}.cbc-btn:active{transform:scale(.95)}
@media(min-width:768px){.bn{max-width:700px;left:50%;transform:translateX(-50%);border-radius:16px 16px 0 0;border:1px solid var(--brd);border-bottom:none}.ov{align-items:center}.sh{border-radius:20px;margin-bottom:3vh;max-height:85vh}.cb{bottom:90px;right:calc(50% - 370px)}}
</style></head><body>

<div id="LS"><div class="lbox">
  <div class="llogo"><span class="llogo-sciences">Sciences</span><span class="llogo-pistes">Pistes</span></div><div class="lsub">Connectez-vous</div>
  <input class="lin" id="le" type="email" placeholder="E-mail"><button class="lbtn" onclick="doL()">Se connecter</button>
  <div class="ldemo"><a onclick="demoL('jade.c@demo.fr')">D√©mo Mentor</a><span style="color:var(--t4)">¬∑</span><a onclick="demoL('franck.d@demo.fr')">D√©mo Parent</a><span style="color:var(--t4)">¬∑</span><a onclick="demoL('lola.b@demo-sp.fr')">D√©mo R√©f√©rent</a></div>
</div></div>

<div class="app" id="app"><div class="tb"><div style="display:flex;align-items:center;gap:4px"><span class="tbl-sciences">Sciences</span><span class="tbl-pistes">Pistes</span></div><div class="tbr"><span class="tbrole" id="tR"></span><div class="tbav" id="tA" onclick="goTo('profile')"></div></div></div><div id="P"></div><div class="bn" id="N"></div><div class="cb"><button class="cbb" onclick="oContact()" title="Contacter l'√©quipe">üí¨</button></div></div>
<div class="ov" id="ov" onclick="if(event.target===this)cS()"><div class="sh" id="sh"></div></div>
<div class="cbd" id="cbd" onclick="if(event.target===this)cCB()"><div class="cbw"><div class="cbh"><div style="font-family:'Newsreader',serif;font-size:18px;font-weight:600">SciencesPistes</div></div><div class="cbm" id="cbm"></div><div class="cbf"><input class="cbf-i ip" id="cbi" placeholder="Votre message..." onkeypress="if(event.key==='Enter')sendCBMsg()"><button class="cbf-b" onclick="sendCBMsg()">‚û§</button></div></div></div>
<div class="to" id="to"></div>

<script type="module">
// ============ SUPABASE CONFIG ============
// Pour connecter Supabase :
// 1. Cr√©er un projet sur https://supabase.com
// 2. Copier l'URL et la cl√© anon ci-dessous
// 3. D√©commenter les lignes ci-dessous et commenter les donn√©es de d√©mo

import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
const SUPABASE_URL = 'https://miybjlxcfhshkmmwqvdg.supabase.co'
const SUPABASE_KEY = 'VOTRE_CLE_ANON_SUPABASE_ICI' // ‚ö†Ô∏è Remplacez par votre cl√© anon depuis Supabase Dashboard > Settings > API
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

// ============ SQL POUR CR√âER LES TABLES ============
/*
-- Tables Supabase (√† ex√©cuter dans le SQL Editor)

CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  role TEXT CHECK (role IN ('tutor','parent','referent')) NOT NULL,
  first_name TEXT,
  last_name TEXT,
  phone TEXT,
  address TEXT,
  campus TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE tutors (
  id UUID PRIMARY KEY REFERENCES users(id),
  year TEXT,
  bac DECIMAL,
  subjects TEXT[],
  presentation TEXT,
  siret TEXT,
  video_url TEXT
);

CREATE TABLE parents (
  id UUID PRIMARY KEY REFERENCES users(id),
  antenne TEXT
);

CREATE TABLE referents (
  id UUID PRIMARY KEY REFERENCES users(id),
  antenne TEXT
);

CREATE TABLE demands (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_name TEXT NOT NULL,
  level TEXT NOT NULL,
  subjects TEXT[],
  frequency TEXT,
  price_family DECIMAL,
  price_tutor DECIMAL,
  availability TEXT,
  info TEXT,
  address TEXT,
  parent_id UUID REFERENCES users(id),
  tutor_assigned UUID REFERENCES users(id),
  status TEXT DEFAULT 'active',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE candidatures (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tutor_id UUID REFERENCES users(id),
  demand_id UUID REFERENCES demands(id),
  status TEXT CHECK (status IN ('pending','validated','refused','withdrawn')) DEFAULT 'pending',
  message TEXT,
  viewed BOOLEAN DEFAULT FALSE,
  viewed_by TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE declarations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tutor_id UUID REFERENCES users(id),
  demand_id UUID REFERENCES demands(id),
  month TEXT,
  hours DECIMAL,
  detail TEXT,
  feedback TEXT,
  status TEXT DEFAULT 'draft',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE invoices (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  parent_id UUID REFERENCES users(id),
  demand_id UUID REFERENCES demands(id),
  month TEXT,
  amount DECIMAL,
  hours DECIMAL,
  status TEXT CHECK (status IN ('pending','paid')) DEFAULT 'pending',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE onboarding_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT NOT NULL,
  type TEXT CHECK (type IN ('inscription','callback')),
  full_name TEXT,
  phone TEXT,
  address TEXT,
  child_name TEXT,
  child_level TEXT,
  subjects TEXT[],
  frequency TEXT,
  availability TEXT,
  notes TEXT,
  processed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Row Level Security
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE demands ENABLE ROW LEVEL SECURITY;
ALTER TABLE candidatures ENABLE ROW LEVEL SECURITY;
ALTER TABLE declarations ENABLE ROW LEVEL SECURITY;
ALTER TABLE invoices ENABLE ROW LEVEL SECURITY;

-- Exemple RLS : un parent ne voit que ses propres donn√©es
CREATE POLICY "Users see own data" ON users FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Parents see own demands" ON demands FOR SELECT USING (auth.uid() = parent_id);
CREATE POLICY "Tutors see active demands" ON demands FOR SELECT USING (status = 'active' AND tutor_assigned IS NULL);

-- Auth : utiliser Magic Link (email)
-- Configurer dans Supabase Dashboard > Authentication > Providers > Email
-- Activer "Magic Link" et d√©sactiver le mot de passe
*/

const D={
t:[{id:'t1',fn:'Jade',ln:'Champollion',em:'jade.c@demo.fr',te:'06 XX XX XX 78',ca:'Paris',yr:'3A',bac:17.55,su:['Math√©matiques','Physique-Chimie','Fran√ßais','M√©thodologie'],ini:'JC',pr:"√âtudiante en 3√®me ann√©e √† Sciences Po Paris, Jade est passionn√©e par les sciences et la transmission. Elle d√©veloppe une approche personnalis√©e et √† l'√©coute. Disponible mercredis apr√®s-midi et samedis.",si:null,vid:null,lk:['d1','d3'],ad:'42 rue des √âcoles, 75005 Paris'}],
p:[{id:'p1',fn:'Sandra',ln:'Martin',em:'sandra.m@demo.fr',te:'06 XX XX XX 69',ad:'Avenue du Roule, 92200 Neuilly',an:'Paris',ini:'SM',ch:['d1']},{id:'p2',fn:'Franck',ln:'Dupont',em:'franck.d@demo.fr',te:'06 XX XX XX 56',ad:'14 av. de Suffren, 75007 Paris',an:'Paris',ini:'FD',ch:['d2','d3']}],
r:[{id:'r1',fn:'Lola',ln:'Bernard',em:'lola.b@demo-sp.fr',te:'06 XX XX XX 66',an:'Paris',ini:'LB'}],
dm:[
{id:'d1',st:'Sasha',lv:'5e',su:['Math√©matiques'],fr:'1h/sem',py:'33‚Ç¨/h',pt:'20‚Ç¨/h',di:'Mercredi 16h30-17h30',in:'Besoin aide en maths et accompagnement devoirs.',ad:'92200, Neuilly-sur-Seine',pi:'p1',ac:1,si:'3 jours',cn:3,ti:'t1',cr:'2026-02-04'},
{id:'d2',st:'Tess',lv:'Terminale',su:['Philosophie','SES','Anglais'],fr:'5h/sem',py:'36‚Ç¨/h',pt:'22‚Ç¨/h',di:'Lundi apr√®s 16h, jeudi soir, samedi matin',in:'Accompagnement Philo, SES et anglais.',ad:'75007, Paris 7e',pi:'p2',ac:1,si:'5 jours',cn:1,ti:null,cr:'2026-02-02'},
{id:'d3',st:'Maxime',lv:'CM2',su:['Un peu de tout'],fr:'2h/sem',py:'33‚Ç¨/h',pt:'20‚Ç¨/h',di:'Mardi et jeudi 17h-18h',in:'Accompagnement global et m√©thodologie.',ad:'75007, Paris 7e',pi:'p2',ac:1,si:'12 jours',cn:5,ti:'t1',cr:'2026-01-12'},
{id:'d4',st:'Killian',lv:'Terminale',su:['Math√©matiques'],fr:'1h30/sem',py:'35‚Ç¨/h',pt:'20‚Ç¨/h',di:'Samedi matin ou mercredi apr√®s-midi',in:'Pr√©pa bac, soutien r√©gulier maths.',ad:'95390, Saint-Prix',pi:null,ac:1,si:'1 jour',cn:0,ti:null,cr:'2026-02-08'},
{id:'d5',st:'Emma',lv:'4e',su:['Fran√ßais','Histoire-g√©o'],fr:'2h/sem',py:'33‚Ç¨/h',pt:'20‚Ç¨/h',di:'Mardi 17h-19h, vendredi 17h-19h',in:'Difficult√©s r√©daction et dissertation.',ad:'75016, Paris 16e',pi:null,ac:1,si:'2 jours',cn:2,ti:null,cr:'2026-02-07'},
{id:'d6',st:'Adam',lv:'6e',su:['M√©thodologie'],fr:'3h/sem',py:'33‚Ç¨/h',pt:'20‚Ç¨/h',di:'Lun, mer, ven 16h30-18h',in:'Entr√©e en 6e, besoin organisation.',ad:'92100, Boulogne',pi:null,ac:1,si:'7 jours',cn:1,ti:null,cr:'2026-02-01'}],
ca:[
{id:'c1',ti:'t1',di:'d1',s:'validated',dt:'2026-02-05',vw:1,vb:'ref',mg:'Bonjour, ravie d\'accompagner Sasha. J\'ai travaill√© les maths jusqu\'au Bac l\'an dernier, disponible mercredis apr√®s-midi.'},
{id:'c2',ti:'t1',di:'d3',s:'validated',dt:'2026-01-15',vw:1,vb:'ref',mg:'Bonjour, disponible pour accompagner Maxime, habitu√©e √† travailler avec des √©l√®ves de primaire.'},
{id:'c3',ti:'t1',di:'d5',s:'pending',dt:'2026-02-08',vw:1,vb:'ref',mg:'Bonjour, ravie d\'aider Emma en fran√ßais et histoire-g√©o. Disponible mardis et vendredis.'},
{id:'c4',ti:'t1',di:'d2',s:'refused',dt:'2024-10-11',vw:1,vb:'parent',mg:'Bonjour, disponible pour accompagner Tess dans ses mati√®res litt√©raires.'}],
dc:[
{id:'dc1',ti:'t1',di:'d1',mo:'F√©vrier 2026',h:4.5,dt:'04/02: 1h ¬∑ 06/02: 1h30 ¬∑ 11/02: 2h',fb:'',s:'draft'},
{id:'dc2',ti:'t1',di:'d3',mo:'F√©vrier 2026',h:6.5,dt:'04/02: 1h ¬∑ 06/02: 1h30 ¬∑ 11/02: 2h ¬∑ 18/02: 2h',fb:'',s:'draft'},
{id:'dc3',ti:'t1',di:'d1',mo:'Janvier 2026',h:4,dt:'07/01: 1h ¬∑ 14/01: 1h ¬∑ 21/01: 1h ¬∑ 28/01: 1h',fb:'Sasha progresse bien',s:'validated'},
{id:'dc4',ti:'t1',di:'d3',mo:'Janvier 2026',h:12,dt:'07/01: 2h ¬∑ 09/01: 1h ¬∑ 14/01: 1h30 ¬∑ 21/01: 2h ¬∑ 28/01: 2h',fb:'Tr√®s bon investissement',s:'validated'}],
iv:[{id:'i1',pi:'p2',di:'d3',mo:'Janvier 2026',am:'396‚Ç¨',h:12,s:'paid',dt:'2026-02-03'},{id:'i2',pi:'p1',di:'d1',mo:'Janvier 2026',am:'132‚Ç¨',h:4,s:'paid',dt:'2026-02-03'}]
};
function cs(t,d){return{d1:92,d2:78,d3:85,d4:65,d5:88,d6:71}[d]||70}
let R='tutor',U=null,CB={st:0,data:{}};
function demoL(em){document.getElementById('le').value=em;doL();}
function doL(){var em=document.getElementById('le').value.trim();if(!em){toast('Veuillez entrer votre email');return;}var u=null;if(D.t.some(x=>{if(x.em===em){u=x;R='tutor';return true;}})){}else if(D.p.some(x=>{if(x.em===em){u=x;R='parent';return true;}})){}else if(D.r.some(x=>{if(x.em===em){u=x;R='ref';return true;}})){}if(u){U=u;document.getElementById('LS').style.display='none';document.getElementById('app').classList.add('on');document.getElementById('tA').textContent=U.ini;document.getElementById('tR').textContent=R==='tutor'?'Mentor':R==='parent'?'Parent':'R√©f√©rent¬∑e';bA();}else{oOnboard(em);}}
function doLo(){document.getElementById('app').classList.remove('on');document.getElementById('LS').style.display='flex';}
function bA(){const P=document.getElementById('P'),N=document.getElementById('N');if(R==='tutor')bT(P,N);else if(R==='parent')bP(P,N);else bR(P,N);}
function bN(n,i){n.innerHTML=i.map((x,j)=>'<button class="ni'+(j===0?' on':'')+'" onclick="goTo(\''+x.id+'\',this)">'+x.ic+'<span class="nl">'+x.lb+'</span></button>').join('');}
function goTo(p,e){document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'));var el=document.getElementById('pg-'+p);if(el)el.classList.add('on');if(e){document.querySelectorAll('.ni').forEach(n=>n.classList.remove('on'));e.classList.add('on');}window.scrollTo({top:0,behavior:'smooth'});}

// ===== CHATBOT ONBOARDING =====
var CBFlow={
0:{msg:'Bienvenue chez SciencesPistes ! üëã Je suis l√† pour vous aider. Que souhaitez-vous faire ?',btns:[{text:'Inscrire mon enfant',val:'inscr'},{text:'√ätre recontact√©¬∑e',val:'callback'}]},
1:{msg:'Pas de souci ! Pouvez-vous me donner votre nom et votre num√©ro de t√©l√©phone ? Je transmets √† notre √©quipe.',inp:['name','phone']},
1.5:{msg:'Parfait [name], notre √©quipe vous recontactera tr√®s vite ! üôå',btn:'Terminer'},
2:{msg:'Super ! Commen√ßons par vous. Quel est votre nom complet ?',inp:['fullname']},
3:{msg:'Merci [fullname] ! Quel est votre num√©ro de t√©l√©phone ?',inp:['phone']},
4:{msg:'Et votre adresse (pour trouver un mentor proche de chez vous) ?',inp:['address']},
5:{msg:'Parfait ! Maintenant parlons de votre enfant. Comment s\'appelle-t-il/elle et en quelle classe est-il/elle ? (ex: Emma, 4e)',inp:['child']},
6:{msg:'Dans quelles mati√®res a-t-il/elle besoin d\'aide ?',btns:[{text:'Maths',val:'Math√©matiques'},{text:'Fran√ßais',val:'Fran√ßais'},{text:'Physique-Chimie',val:'Physique-Chimie'},{text:'Anglais',val:'Anglais'},{text:'SVT',val:'SVT'},{text:'Philo',val:'Philosophie'},{text:'SES',val:'SES'},{text:'M√©thodologie',val:'M√©thodologie'},{text:'Autre',val:'Autre'}],mult:true},
7:{msg:'Combien d\'heures par semaine souhaitez-vous ?',btns:[{text:'1h/sem',val:'1h/sem'},{text:'1h30/sem',val:'1h30/sem'},{text:'2h/sem',val:'2h/sem'},{text:'3h/sem',val:'3h/sem'},{text:'4h/sem',val:'4h/sem'},{text:'5h+/sem',val:'5h+/sem'}]},
8:{msg:'Quels cr√©neaux vous arrangent ?',inp:['availability']},
9:{msg:'Derni√®re question : avez-vous des infos √† nous transmettre ? (difficult√©s, objectifs...)',inp:['notes',true]},
10:{msg:'Parfait ! Votre demande a √©t√© transmise √† notre √©quipe. Un r√©f√©rent vous contactera dans les 24h. üéâ',btn:'Terminer'}
};
function oOnboard(em){CB={st:0,data:{email:em,type:''}};cbShow();cbNext();}
function cbShow(){document.getElementById('cbd').classList.add('on');document.body.style.overflow='hidden';}
function cCB(){document.getElementById('cbd').classList.remove('on');document.body.style.overflow='';CB={st:0,data:{}};}
function cbNext(){var s=CB.st,f=CBFlow[s];if(!f)return;cbClear();var m=f.msg;if(m.includes('[name]'))m=m.replace('[name]',CB.data.name||'');if(m.includes('[fullname]'))m=m.replace('[fullname]',CB.data.fullname||'');cbAddMsg('bot',m);if(f.btns&&!f.mult){setTimeout(()=>{f.btns.forEach(b=>{var el=document.createElement('button');el.className='cbc-btn';el.textContent=b.text;el.onclick=()=>{CB.data.choice=b.val;if(s===0){CB.data.type=b.val==='inscr'?'inscription':'callback';}cbAddMsg('user',b.text);if(b.val==='callback'){CB.st=1.5;}else{CB.st=2;}setTimeout(()=>cbNext(),300);};document.querySelector('.cbm').appendChild(el);});},100);}else if(f.btns&&f.mult){setTimeout(()=>{var cont=document.createElement('div');cont.className='cbc';f.btns.forEach(b=>{var el=document.createElement('button');el.className='cbc-btn';el.textContent=b.text;el.onclick=()=>{if(!CB.data.subjects)CB.data.subjects=[];var idx=CB.data.subjects.indexOf(b.val);if(idx>-1){CB.data.subjects.splice(idx,1);el.style.opacity='0.4';}else{CB.data.subjects.push(b.val);el.style.opacity='1';}};cont.appendChild(el);});var valbtn=document.createElement('button');valbtn.className='bt bp';valbtn.textContent='Valider';valbtn.style.width='100%';valbtn.style.margin='8px 0 0';valbtn.onclick=()=>{cbAddMsg('user',(CB.data.subjects||[]).join(', '));CB.st=7;setTimeout(()=>cbNext(),300);};cont.appendChild(valbtn);document.querySelector('.cbm').appendChild(cont);},100);}else if(f.inp){setTimeout(()=>{var cont=document.createElement('div');cont.style.display='flex';cont.style.flexDirection='column';cont.style.gap='8px';f.inp.forEach(k=>{if(k!==true){var inp=document.createElement('input');inp.className='ip';inp.placeholder=k==='name'?'Votre nom':k==='phone'?'T√©l√©phone':k==='fullname'?'Nom complet':k==='address'?'Adresse':k==='child'?'Ex: Emma, 4e':k==='availability'?'Ex: Mardi 17h-18h, jeudi soir':'Votre message';inp.id='cb-'+k;cont.appendChild(inp);}});if(f.inp.includes(true)){var ta=document.createElement('textarea');ta.className='ip';ta.placeholder='(optionnel)';ta.id='cb-notes';ta.style.minHeight='60px';cont.appendChild(ta);}var valbtn=document.createElement('button');valbtn.className='bt bp';valbtn.textContent='Suivant';valbtn.style.width='100%';valbtn.style.marginTop='8px';valbtn.onclick=()=>{var v='',all=true;f.inp.forEach(k=>{if(k!==true){var el=document.getElementById('cb-'+k);if(!el.value.trim()&&k!=='notes'){all=false;}v+=el.value.trim()+'|';}});if(!all){toast('Veuillez remplir tous les champs');return;}CB.data[f.inp[0]]=document.getElementById('cb-'+f.inp[0]).value.trim();if(f.inp.length>1)CB.data[f.inp[1]]=document.getElementById('cb-'+f.inp[1]).value.trim();if(document.getElementById('cb-notes'))CB.data.notes=document.getElementById('cb-notes').value.trim();cbAddMsg('user',CB.data[f.inp[0]]);CB.st+=1;setTimeout(()=>cbNext(),300);};cont.appendChild(valbtn);document.querySelector('.cbm').appendChild(cont);},100);}else if(f.btn){setTimeout(()=>{var valbtn=document.createElement('button');valbtn.className='bt bp';valbtn.textContent=f.btn;valbtn.style.width='100%';valbtn.style.marginTop='8px';valbtn.onclick=()=>{cCB();toast('‚úÖ Demande enregistr√©e');};document.querySelector('.cbm').appendChild(valbtn);},100);}}
function cbClear(){var m=document.getElementById('cbm');m.innerHTML='';}
function cbAddMsg(type,text){var m=document.getElementById('cbm'),div=document.createElement('div');div.className='cbm-msg '+(type==='bot'?'cbm-bot':'cbm-user');var bubble=document.createElement('div');bubble.className='cbm-bubble';bubble.textContent=text;div.appendChild(bubble);m.appendChild(div);setTimeout(()=>{document.querySelector('.cbm').scrollTop=document.querySelector('.cbm').scrollHeight;},50);}
function sendCBMsg(){var inp=document.getElementById('cbi');if(!inp.value.trim())return;cbAddMsg('user',inp.value);inp.value='';setTimeout(()=>{cbAddMsg('bot','Merci ! On traite votre message. √Ä bient√¥t ! üëã');setTimeout(()=>cCB(),2000);},500);}

// ===== TUTOR =====
function bT(P,N){var t=U,op=D.dm.filter(d=>d.ac&&!d.ti),mc=D.ca.filter(c=>c.ti===t.id),md=D.dc.filter(d=>d.ti===t.id),ms=D.dm.filter(d=>t.lk.includes(d.id));
P.innerHTML='<div class="pg on" id="pg-board"><div class="pgt">Offres disponibles</div><div class="pgs">'+op.length+' annonce'+(op.length>1?'s':'')+' pr√®s de chez toi</div>'+op.map(d=>'<div class="cd cc" onclick="oOffer(\''+d.id+'\')"><div style="display:flex;justify-content:space-between;margin-bottom:6px"><div style="font-weight:600">'+d.st+' ‚Äî '+d.lv+'</div><div style="font-size:11px;color:var(--t4)">il y a '+d.si+'</div></div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px">'+d.su.map(s=>'<span class="ch chs">'+s+'</span>').join('')+'<span class="ch chf">'+d.fr+'</span><span class="ch chp">'+d.pt+'</span></div><div style="font-size:12px;color:var(--t3)">üìç '+d.ad+'</div><div class="ch chc" style="margin-top:6px">‚ö° '+cs(t.id,d.id)+'%</div></div>').join('')+'</div>'+
'<div class="pg" id="pg-students"><div class="pgt">Mes √©l√®ves</div><div class="pgs">√âl√®ves qui te sont attribu√©s</div>'+(ms.length?ms.map(d=>{var p=D.p.find(x=>x.id===d.pi);return '<div class="cd"><div style="font-weight:600;font-size:16px;margin-bottom:6px">'+d.st+' ‚Äî '+d.lv+'</div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px">'+d.su.map(s=>'<span class="ch chs">'+s+'</span>').join('')+'<span class="ch chf">'+d.fr+'</span></div><div style="font-size:13px;color:var(--t3);margin-bottom:4px">üìç '+d.ad+'</div><div style="font-size:13px;color:var(--t3)">üìÖ '+d.di+'</div>'+(p?'<div class="dv"></div><div style="font-size:13px"><strong>Parent :</strong> '+p.fn+' '+p.ln+'</div><div style="font-size:13px;color:var(--t2)">üìß '+p.em+' ¬∑ üì± '+p.te+'</div>':'')+'</div>';}).join(''):'<div style="text-align:center;padding:40px;color:var(--t3)"><div style="font-size:40px;margin-bottom:12px">üìö</div>Pas encore d\'√©l√®ve. Postule √† des offres !</div>')+'</div>'+
'<div class="pg" id="pg-cand"><div class="pgt">Mes candidatures</div><div class="pgs">Clique pour voir le d√©tail</div>'+['validated','pending','refused'].map(s=>{var i=mc.filter(c=>c.s===s);if(!i.length)return'';var lb={validated:'‚úÖ Valid√©',pending:'‚è± En attente',refused:'üòî Refus√©¬∑e'},bc={validated:'bgg',pending:'bga',refused:'bgx'};return '<div class="st">'+lb[s]+'</div>'+i.map(c=>{var d=D.dm.find(x=>x.id===c.di);return '<div class="cd cc" onclick="oCandD(\''+c.id+'\')"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><div style="font-weight:600">'+d.st+' ‚Äî '+d.lv+'</div><div style="font-size:11px;color:var(--t4)">'+fD(c.dt)+'</div></div><div style="font-size:12px;color:var(--t3)">'+d.ad+' ‚Äî '+d.fr+'</div><div style="display:flex;align-items:center;gap:8px;margin-top:6px;flex-wrap:wrap"><div class="bg '+bc[s]+'">'+lb[s]+'</div>'+(c.vw?'<span class="vd">Vue par le '+(c.vb==='ref'?'r√©f√©rent':'parent')+'</span>':'')+'</div></div>';}).join('');}).join('')+'</div>'+
'<div class="pg" id="pg-decl"><div class="pgt">D√©clarations</div><div class="pgs">D√©clare tes heures en fin de mois</div>'+gp(md,'mo').map(function(x){var m=x[0],i=x[1];return '<div class="st">'+m+'</div>'+i.map(dc=>{var d=D.dm.find(x=>x.id===dc.di);return '<div class="cd" style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:600">'+d.st+'</div><div style="font-size:12px;color:var(--t3);margin-top:2px">'+dc.dt+'</div>'+(dc.fb?'<div style="font-size:12px;color:var(--gn);margin-top:2px">üí¨ '+dc.fb+'</div>':'')+'</div><div style="font-family:Newsreader,serif;font-size:20px;font-weight:600;color:var(--co)">'+dc.h+'<small style="font-size:12px;color:var(--t3);font-family:Outfit;font-weight:400">h</small></div></div>';}).join('');}).join('')+'<button class="bt bo bf" style="margin-top:14px" onclick="oNewDecl()">+ Ajouter une d√©claration</button></div>'+
'<div class="pg" id="pg-profile">'+pH(t)+(!t.vid?'<div class="vb" onclick="toast(\'Upload vid√©o bient√¥t disponible\')"><div style="font-size:32px;margin-bottom:6px">üé¨</div><p><strong style="color:var(--co)">Ajoute ta vid√©o de pr√©sentation !</strong><br>Les parents la voient en priorit√©. Les mentors avec vid√©o sont s√©lectionn√©s <strong>3x plus souvent</strong>.</p></div>':'<div class="cd" style="text-align:center"><div style="font-size:32px;margin-bottom:6px">üé¨</div><div style="font-size:13px;color:var(--gn);font-weight:600">Vid√©o en ligne ‚úÖ</div></div>')+(!t.si?'<div class="wb">‚ö†Ô∏è <strong>SIRET manquant.</strong> Pour √™tre pay√©¬∑e, ajoute ton num√©ro SIRET. <a href="#">Guide auto-entrepreneur ‚Üí</a></div>':'')+'<div class="st">Informations <button class="bt bo bs" style="margin-left:auto" onclick="ePro()">Modifier</button></div>'+pR('T√©l√©phone',t.te)+pR('Adresse',t.ad)+pR('Campus',t.ca)+pR('Ann√©e',t.yr)+pR('Bac',t.bac)+pR('SIRET',t.si||'<span style="color:var(--co)">Non renseign√©</span>')+'<div class="st">Mati√®res</div><div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px">'+t.su.map(s=>'<span class="ch chs">'+s+'</span>').join('')+'</div><div class="st">Pr√©sentation</div><div class="cd" style="font-size:13px;line-height:1.65;color:var(--t2)">'+t.pr+'</div><div class="st">Parrainage</div><div class="ib">üéÅ <strong>Parraine un¬∑e ami¬∑e ‚Üí 30‚Ç¨ de bonus</strong><br><div style="margin-top:6px;padding:8px 12px;background:var(--wh);border-radius:8px;font-weight:600;color:var(--co);display:flex;justify-content:space-between;align-items:center;cursor:pointer" onclick="toast(\'Lien copi√© !\')">sciencespistes.fr/p/jade-c <span style="font-size:12px">üìã</span></div></div><button class="bt bo bf" onclick="doLo()">Se d√©connecter</button></div>';
bN(N,[{id:'board',lb:'Offres',ic:ic('grid')},{id:'students',lb:'√âl√®ves',ic:ic('book')},{id:'cand',lb:'Candidatures',ic:ic('inbox')},{id:'decl',lb:'D√©clarations',ic:ic('file')},{id:'profile',lb:'Profil',ic:ic('user')}]);}

// ===== PARENT =====
function bP(P,N){var p=U,md=D.dm.filter(d=>p.ch.includes(d.id)),mdc=D.dc.filter(dc=>p.ch.includes(dc.di)),mi=D.iv.filter(iv=>iv.pi===p.id);
P.innerHTML='<div class="pg on" id="pg-demands"><div class="pgt">Mes demandes</div><div class="pgs">Vos demandes d\'accompagnement</div>'+md.map(d=>{var tu=d.ti?D.t.find(x=>x.id===d.ti):null;return '<div class="cd cc" onclick="oDemP(\''+d.id+'\')"><div style="display:flex;justify-content:space-between;margin-bottom:6px"><div style="font-weight:600;font-size:15px">'+d.st+'</div><div style="font-size:11px;color:var(--t4)">'+fD(d.cr)+'</div></div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px"><span class="ch chl">'+d.lv+'</span>'+d.su.map(s=>'<span class="ch chs">'+s+'</span>').join('')+'<span class="ch chf">'+d.fr+'</span></div>'+(tu?'<div class="bg bgg">‚úÖ Mentor : '+tu.fn+' '+tu.ln+'</div>':'<div class="bg bga">‚è± En attente</div>')+'</div>';}).join('')+'<button class="bt bo bf" style="margin-top:14px" onclick="oNewDemP()">+ Ajouter une demande</button></div>'+
'<div class="pg" id="pg-pdecl"><div class="pgt">D√©clarations & factures</div><div class="pgs">Suivi des cours et facturation</div><div class="it"><button class="itb on" onclick="sPT(\'dc\',this)">D√©clarations</button><button class="itb" onclick="sPT(\'iv\',this)">Factures</button></div><div id="pt-dc">'+gp(mdc,'mo').map(function(x){var m=x[0],i=x[1];return '<div class="st">'+m+'</div>'+i.map(dc=>{var d=D.dm.find(x=>x.id===dc.di);var t=D.t.find(x=>x.id===dc.ti);return '<div class="cd cc" onclick="oDclP(\''+dc.id+'\')"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:600">'+d.st+'</div><div style="font-size:12px;color:var(--t3)">'+((t?t.fn:'')+' ¬∑ '+dc.dt)+'</div></div><div style="text-align:right"><div style="font-family:Newsreader,serif;font-size:20px;font-weight:600;color:var(--co)">'+dc.h+'h</div><div class="bg '+(dc.s==='validated'?'bgg':'bga')+'" style="margin-top:2px">'+(dc.s==='validated'?'Valid√©e':'Brouillon')+'</div></div></div></div>';}).join('');}).join('')+'</div><div id="pt-iv" style="display:none">'+(mi.length?mi.map(iv=>{var d=D.dm.find(x=>x.id===iv.di);return '<div class="cd"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:600">'+(d?d.st:'')+' ‚Äî '+iv.mo+'</div><div style="font-size:12px;color:var(--t3)">'+iv.h+'h</div></div><div style="text-align:right"><div style="font-family:Newsreader,serif;font-size:18px;font-weight:600">'+iv.am+'</div><div class="bg '+(iv.s==='paid'?'bgg':'bga')+'">'+(iv.s==='paid'?'Pay√©e':'En attente')+'</div></div></div></div>';}).join(''):'<div style="text-align:center;padding:30px;color:var(--t3)">Aucune facture</div>')+'</div></div>'+
'<div class="pg" id="pg-profile">'+pH(p,'bl')+'<div class="ib">üéÅ <strong>Parrainez ‚Üí 2h offertes + 1h pour votre filleul</strong><br><div style="margin-top:6px;padding:8px 12px;background:var(--wh);border-radius:8px;font-weight:600;color:var(--co);display:flex;justify-content:space-between;align-items:center;cursor:pointer" onclick="toast(\'Lien copi√© !\')">sciencespistes.fr/r/franck <span style="font-size:12px">üìã</span></div></div><div class="st">Informations <button class="bt bo bs" style="margin-left:auto" onclick="eProP()">Modifier</button></div>'+pR('T√©l√©phone',p.te)+pR('Adresse',p.ad)+pR('Antenne',p.an)+'<div class="st">Votre r√©f√©rent</div><div class="cd" style="display:flex;align-items:center;gap:12px"><div style="width:42px;height:42px;border-radius:50%;background:var(--cl);color:var(--co);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0">LB</div><div><div style="font-weight:600">'+D.r[0].fn+' '+D.r[0].ln+'</div><div style="font-size:12px;color:var(--t3)">'+D.r[0].te+' ¬∑ '+D.r[0].em+'</div></div></div><button class="bt bo bf" style="margin-top:20px" onclick="doLo()">Se d√©connecter</button></div>';
bN(N,[{id:'demands',lb:'Demandes',ic:ic('grid')},{id:'pdecl',lb:'Suivi',ic:ic('file')},{id:'profile',lb:'Profil',ic:ic('user')}]);}
function sPT(t,e){document.querySelectorAll('.itb').forEach(x=>x.classList.remove('on'));e.classList.add('on');document.getElementById('pt-dc').style.display=t==='dc'?'block':'none';document.getElementById('pt-iv').style.display=t==='iv'?'block':'none';}

// ===== REFERENT =====
function bR(P,N){var r=U,pc=D.ca.filter(c=>c.s==='pending'),act=D.dm.filter(d=>d.ac),wt=act.filter(d=>d.ti),nt=act.filter(d=>!d.ti);
P.innerHTML='<div class="pg on" id="pg-dash"><div class="pgt">Bonjour '+r.fn+'</div><div class="pgs">Antenne '+r.an+'</div><div class="sr"><div class="sc"><div class="sv" style="color:var(--co)">'+act.length+'</div><div class="slb">Annonces</div></div><div class="sc"><div class="sv" style="color:var(--gn)">'+wt.length+'</div><div class="slb">Accompagn√©s</div></div><div class="sc"><div class="sv" style="color:var(--am)">'+pc.length+'</div><div class="slb">√Ä traiter</div></div><div class="sc"><div class="sv" style="color:var(--bl)">'+D.p.length+'</div><div class="slb">Familles</div></div></div>'+(pc.length?'<div class="st">üî¥ √Ä traiter</div>'+pc.map(c=>{var d=D.dm.find(x=>x.id===c.di);var t=D.t.find(x=>x.id===c.ti);return '<div class="ac" onclick="oCandR(\''+c.id+'\')"><span>üìã</span><div><strong>'+t.fn+' '+t.ln+'</strong> ‚Üí '+d.st+' ‚Äî '+d.lv+'</div></div>';}).join(''):'')+(nt.length?'<div class="st">‚è± Sans mentor</div>'+nt.map(d=>'<div class="ac" style="background:var(--al);border-color:rgba(212,147,10,.12)" onclick="oRefDem(\''+d.id+'\')"><span>‚è±</span><div><strong>'+d.st+'</strong> ‚Äî '+d.lv+' ‚Äî '+d.su[0]+' ‚Äî depuis '+d.si+'</div></div>').join(''):'')+'</div>'+
'<div class="pg" id="pg-clients"><div class="pgt">Familles</div><div class="pgs">Gestion des clients</div><button class="bt bp bs" style="margin-bottom:14px" onclick="oNewCl()">+ Ajouter un client</button>'+D.p.map(p=>'<div class="cd cc" onclick="oClR(\''+p.id+'\')"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><div style="font-weight:600">'+p.fn+' '+p.ln+'</div><div style="font-size:11px;color:var(--t4)">'+p.an+'</div></div><div style="font-size:12px;color:var(--t3);margin-bottom:6px">'+p.em+' ¬∑ '+p.te+'</div><div style="display:flex;flex-wrap:wrap;gap:5px">'+D.dm.filter(d=>p.ch.includes(d.id)).map(d=>'<div class="bg '+(d.ti?'bgg':'bga')+'">'+d.st+' ‚Äî '+(d.ti?'Recrut√©':'Attente')+'</div>').join('')+'</div></div>').join('')+'</div>'+
'<div class="pg" id="pg-rcand"><div class="pgt">Candidatures</div><div class="pgs">Toutes les candidatures</div><div class="it"><button class="itb on" onclick="fRC(\'all\',this)">Toutes</button><button class="itb" onclick="fRC(\'pending\',this)">Attente</button><button class="itb" onclick="fRC(\'validated\',this)">Valid√©es</button><button class="itb" onclick="fRC(\'refused\',this)">Refus√©es</button></div><div id="rcL"></div></div>'+
'<div class="pg" id="pg-rdecl"><div class="pgt">D√©clarations</div><div class="pgs">Toutes les d√©clarations</div>'+gp(D.dc,'mo').map(function(x){var m=x[0],i=x[1];return '<div class="st">'+m+'</div>'+i.map(dc=>{var d=D.dm.find(x=>x.id===dc.di);var t=D.t.find(x=>x.id===dc.ti);return '<div class="cd" style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:600">'+(d?d.st:'')+' <span style="color:var(--t3);font-weight:400">‚Äî '+(t?t.fn:'')+'</span></div><div style="font-size:12px;color:var(--t3);margin-top:2px">'+dc.dt+'</div></div><div style="text-align:right"><div style="font-family:Newsreader,serif;font-size:18px;font-weight:600;color:var(--co)">'+dc.h+'h</div><div class="bg '+(dc.s==='validated'?'bgg':'bga')+'" style="margin-top:2px">'+(dc.s==='validated'?'OK':'Brouillon')+'</div></div></div>';}).join('');}).join('')+'</div>'+
'<div class="pg" id="pg-profile">'+pH(U)+pR('T√©l√©phone',r.te)+pR('Antenne',r.an)+pR('Email',r.em)+'<button class="bt bo bf" style="margin-top:20px" onclick="doLo()">Se d√©connecter</button></div>';
rRC('all');bN(N,[{id:'dash',lb:'Dashboard',ic:ic('home')},{id:'clients',lb:'Familles',ic:ic('users')},{id:'rcand',lb:'Candidatures',ic:ic('inbox')},{id:'rdecl',lb:'D√©clarations',ic:ic('file')},{id:'profile',lb:'Profil',ic:ic('user')}]);}
function rRC(f){var el=document.getElementById('rcL');if(!el)return;var c2=f==='all'?D.ca:D.ca.filter(c=>c.s===f);var bm={validated:'bgg',pending:'bga',refused:'bgx'},lm={validated:'‚úÖ Valid√©',pending:'‚è± Attente',refused:'üòî Refus√©'};el.innerHTML=c2.map(c=>{var d=D.dm.find(x=>x.id===c.di);var t=D.t.find(x=>x.id===c.ti);return '<div class="cd cc" onclick="oCandR(\''+c.id+'\')"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><div style="font-weight:600">'+(t?t.fn+' '+t.ln:'')+' ‚Üí '+(d?d.st:'')+'</div><div class="bg '+bm[c.s]+'">'+lm[c.s]+'</div></div><div style="font-size:12px;color:var(--t3)">'+(d?d.lv+' ‚Äî '+d.su.join(', '):'')+' ‚Äî '+fD(c.dt)+'</div></div>';}).join('')||'<div style="text-align:center;padding:30px;color:var(--t3)">Aucune</div>';}
function fRC(f,e){document.querySelectorAll('.itb').forEach(t=>t.classList.remove('on'));e.classList.add('on');rRC(f);}

// ===== SHEETS =====
function oS(h){document.getElementById('sh').innerHTML='<div class="sha"></div>'+h;document.getElementById('ov').classList.add('on');document.body.style.overflow='hidden';}
function cS(){document.getElementById('ov').classList.remove('on');document.body.style.overflow='';}

function oOffer(id){var d=D.dm.find(x=>x.id===id);oS('<div class="sht">'+d.st+'</div><div class="dg"><div class="di"><div class="dll">Classe</div><div class="dvv">'+d.lv+'</div></div><div class="di"><div class="dll">R√©mun√©ration</div><div class="dvv">'+d.pt+'</div></div><div class="di"><div class="dll">Fr√©quence</div><div class="dvv">'+d.fr+'</div></div><div class="di"><div class="dll">Depuis</div><div class="dvv">'+d.si+'</div></div><div class="di df"><div class="dll">Mati√®res</div><div class="dvv">'+d.su.join(', ')+'</div></div><div class="di df"><div class="dll">Disponibilit√©s</div><div class="dvv">'+d.di+'</div></div><div class="di df"><div class="dll">Lieu</div><div class="dvv">'+d.ad+'</div></div><div class="di df"><div class="dll">Infos</div><div class="dvv">'+d.in+'</div></div></div><div class="ch chc" style="margin-bottom:14px">‚ö° '+cs(U.id,d.id)+'%</div><div class="ig"><label class="il">Ton message aux parents</label><textarea class="ip" id="aM" placeholder="Bonjour, je serais ravi¬∑e d\'accompagner '+d.st+'..."></textarea></div><button class="bt bp bf" onclick="sApp(\''+d.id+'\')">Postuler</button><div style="font-size:11px;color:var(--t3);text-align:center;margin-top:8px">En postulant, tu certifies √™tre disponible et capable de te d√©placer.</div>');}
function sApp(d){var m=document.getElementById('aM');if(!m||m.value.trim().length<20){toast('Message trop court (min 20 car.)');return;}cS();toast('‚úÖ Candidature envoy√©e !');}

function oCandD(id){var c=D.ca.find(x=>x.id===id),d=D.dm.find(x=>x.id===c.di),p=d.pi?D.p.find(x=>x.id===d.pi):null;var lm={validated:'‚úÖ Valid√©',pending:'‚è± En attente',refused:'üòî Refus√©¬∑e'},bm={validated:'bgg',pending:'bga',refused:'bgx'};oS('<div class="sht">'+d.st+' ‚Äî '+d.lv+'</div><div class="bg '+bm[c.s]+'" style="margin-bottom:12px">'+lm[c.s]+'</div>'+(c.vw?'<div class="vd" style="margin-bottom:14px">Vue par le '+(c.vb==='ref'?'r√©f√©rent':'parent')+'</div>':'')+'<div class="dg"><div class="di"><div class="dll">Mati√®res</div><div class="dvv">'+d.su.join(', ')+'</div></div><div class="di"><div class="dll">Fr√©quence</div><div class="dvv">'+d.fr+'</div></div><div class="di df"><div class="dll">Disponibilit√©s</div><div class="dvv">'+d.di+'</div></div><div class="di df"><div class="dll">Lieu</div><div class="dvv">'+d.ad+'</div></div><div class="di df"><div class="dll">Infos</div><div class="dvv">'+d.in+'</div></div></div><div class="st">Ton message</div><div class="cd" style="font-size:13px;color:var(--t2);font-style:italic;line-height:1.6">"'+c.mg+'"</div>'+(c.s==='validated'&&p?'<div class="st">Coordonn√©es famille</div><div class="cd"><div style="font-weight:600">'+p.fn+' '+p.ln+'</div><div style="font-size:13px;color:var(--t2)">üìß '+p.em+' ¬∑ üì± '+p.te+'</div></div>':'')+(c.s==='pending'?'<button class="bt bd bf" style="margin-top:14px" onclick="wCand(\''+c.id+'\')">Retirer ma candidature</button>':''));}
function wCand(id){var c=D.ca.find(x=>x.id===id);if(c)c.s='withdrawn';cS();toast('Candidature retir√©e');bA();}

function oNewDecl(){var t=U,s=D.dm.filter(d=>t.lk.includes(d.id));oS('<div class="sht">Nouvelle d√©claration</div><div class="ig"><label class="il">√âl√®ve</label><select class="ip sl">'+s.map(x=>'<option>'+x.st+' ‚Äî '+x.lv+'</option>').join('')+'</select></div><div class="ig"><label class="il">Mois</label><select class="ip sl"><option>F√©vrier 2026</option><option>Janvier 2026</option></select></div><div class="ig"><label class="il">Nombre d\'heures</label><input class="ip" type="number" step="0.5" placeholder="4.5"></div><div class="ig"><label class="il">D√©tail (date : dur√©e)</label><textarea class="ip" placeholder="04/02 : 1h, 06/02 : 1h30..."></textarea></div><div class="ig"><label class="il">Feedback (optionnel)</label><textarea class="ip" placeholder="Comment se passe l\'accompagnement ?"></textarea></div><button class="bt bp bf" onclick="cS();toast(\'‚úÖ D√©claration enregistr√©e\')">Enregistrer</button>');}

function oDemP(id){var d=D.dm.find(x=>x.id===id),t=d.ti?D.t.find(x=>x.id===d.ti):null;oS('<div class="sht">'+d.st+'</div><div class="dg"><div class="di"><div class="dll">Classe</div><div class="dvv">'+d.lv+'</div></div><div class="di"><div class="dll">Fr√©quence</div><div class="dvv">'+d.fr+'</div></div><div class="di df"><div class="dll">Mati√®res</div><div class="dvv">'+d.su.join(', ')+'</div></div><div class="di df"><div class="dll">Disponibilit√©s</div><div class="dvv">'+d.di+'</div></div></div>'+(t?'<div class="st">Mentor</div>'+(t.vid?'<div class="cd" style="text-align:center;background:var(--s1)"><div style="font-size:28px;margin-bottom:6px">üé¨</div><div style="font-size:13px;color:var(--co);font-weight:600">Voir la vid√©o de '+t.fn+' ‚Üí</div></div>':'')+'<div class="cd" style="display:flex;align-items:center;gap:12px"><div style="width:44px;height:44px;border-radius:50%;background:var(--co);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0">'+t.ini+'</div><div><div style="font-weight:600">'+t.fn+' '+t.ln+'</div><div style="font-size:12px;color:var(--t3)">'+t.ca+' ‚Äî '+t.yr+' ‚Äî Bac '+t.bac+'</div><div style="font-size:12px;color:var(--t3)">'+t.em+' ¬∑ '+t.te+'</div></div></div><div style="font-size:13px;color:var(--t2);margin-top:10px;line-height:1.6">'+t.pr+'</div>':'<div class="wb">‚è± Nous recherchons le mentor id√©al pour '+d.st+'.</div>'));}

function oDclP(id){var dc=D.dc.find(x=>x.id===id),d=D.dm.find(x=>x.id===dc.di),t=D.t.find(x=>x.id===dc.ti);oS('<div class="sht">'+d.st+' ‚Äî '+dc.mo+'</div><div class="dg"><div class="di"><div class="dll">Mentor</div><div class="dvv">'+(t?t.fn+' '+t.ln:'')+'</div></div><div class="di"><div class="dll">Heures</div><div class="dvv">'+dc.h+'h</div></div><div class="di df"><div class="dll">D√©tail</div><div class="dvv">'+dc.dt+'</div></div>'+(dc.fb?'<div class="di df"><div class="dll">Feedback</div><div class="dvv">'+dc.fb+'</div></div>':'')+'</div><div class="bg '+(dc.s==='validated'?'bgg':'bga')+'">'+(dc.s==='validated'?'Valid√©e':'En attente')+'</div>');}

function oNewDemP(){oS('<div class="sht">Nouvelle demande</div><div class="wb">üìã Votre demande sera envoy√©e √† l\'√©quipe pour validation. Votre r√©f√©rent vous recontactera.</div><div class="ig"><label class="il">Pr√©nom de l\'enfant</label><input class="ip" placeholder="Pr√©nom"></div><div class="ig"><label class="il">Classe</label><select class="ip sl"><option>CP</option><option>CE1</option><option>CE2</option><option>CM1</option><option>CM2</option><option>6e</option><option>5e</option><option>4e</option><option>3e</option><option>Seconde</option><option>Premi√®re</option><option>Terminale</option></select></div><div class="ig"><label class="il">Mati√®res</label><input class="ip" placeholder="Maths, Fran√ßais..."></div><div class="ig"><label class="il">Volume horaire</label><select class="ip sl"><option>1h/sem</option><option>1h30/sem</option><option>2h/sem</option><option>3h/sem</option><option>4h/sem</option><option>5h+/sem</option></select></div><div class="ig"><label class="il">Disponibilit√©s</label><textarea class="ip" placeholder="Jours et cr√©neaux"></textarea></div><div class="ig"><label class="il">Infos compl√©mentaires</label><textarea class="ip" placeholder="Difficult√©s, objectifs..."></textarea></div><button class="bt bp bf" onclick="cS();toast(\'‚úÖ Demande envoy√©e √† l\\\'√©quipe !\')">Envoyer</button>');}

function oCandR(id){var c=D.ca.find(x=>x.id===id),d=D.dm.find(x=>x.id===c.di),t=D.t.find(x=>x.id===c.ti);var lm={validated:'‚úÖ Valid√©',pending:'‚è± Attente',refused:'üòî Refus√©'},bm={validated:'bgg',pending:'bga',refused:'bgx'};oS('<div class="sht">'+(t?t.fn+' '+t.ln:'')+' ‚Üí '+(d?d.st:'')+'</div><div class="dg"><div class="di"><div class="dll">√âl√®ve</div><div class="dvv">'+(d?d.st+' ‚Äî '+d.lv:'')+'</div></div><div class="di"><div class="dll">Compat.</div><div class="dvv" style="color:var(--co)">'+cs(t?t.id:'',d?d.id:'')+'%</div></div><div class="di"><div class="dll">Mati√®res</div><div class="dvv">'+(d?d.su.join(', '):'')+'</div></div><div class="di"><div class="dll">Contact</div><div class="dvv">'+(t?t.te:'')+'</div></div></div>'+(t&&t.vid?'<div class="cd" style="text-align:center;background:var(--s1)"><div style="font-size:28px;margin-bottom:4px">üé¨</div><div style="font-size:13px;color:var(--co);font-weight:600">Vid√©o de pr√©sentation</div></div>':'')+'<div class="st">Message</div><div class="cd" style="font-size:13px;color:var(--t2);font-style:italic;line-height:1.6">"'+c.mg+'"</div><div class="st">Pr√©sentation</div><div style="font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:14px">'+(t?t.pr:'')+'</div><div class="bg '+bm[c.s]+'" style="margin-bottom:14px">'+lm[c.s]+'</div>'+(c.s==='pending'?'<div style="display:flex;gap:8px"><button class="bt bp" style="flex:1" onclick="dC(\''+c.id+'\',\'validated\')">‚úÖ Valider</button><button class="bt bd" style="flex:1" onclick="dC(\''+c.id+'\',\'refused\')">‚ùå Refuser</button></div><div style="font-size:11px;color:var(--t3);text-align:center;margin-top:8px">Envoi auto des coordonn√©es.</div>':''));}
function dC(id,s){var c=D.ca.find(x=>x.id===id);if(c)c.s=s;cS();toast(s==='validated'?'‚úÖ Valid√© ‚Äî mails envoy√©s':'‚ùå Refus√©');bA();}

function oClR(id){var p=D.p.find(x=>x.id===id),ds=D.dm.filter(d=>p.ch.includes(d.id));oS('<div class="sht">'+p.fn+' '+p.ln+'</div><div class="dg"><div class="di"><div class="dll">Email</div><div class="dvv">'+p.em+'</div></div><div class="di"><div class="dll">T√©l</div><div class="dvv">'+p.te+'</div></div><div class="di df"><div class="dll">Adresse</div><div class="dvv">'+p.ad+'</div></div></div><div class="st">Demandes ('+ds.length+')</div>'+ds.map(d=>{var t=d.ti?D.t.find(x=>x.id===d.ti):null;return '<div class="cd"><div style="font-weight:600;margin-bottom:4px">'+d.st+' ‚Äî '+d.lv+'</div><div style="font-size:12px;color:var(--t3)">'+d.su.join(', ')+' ‚Äî '+d.fr+'</div><div class="bg '+(t?'bgg':'bga')+'" style="margin-top:6px">'+(t?'‚úÖ '+t.fn+' '+t.ln:'‚è± Attente')+'</div></div>';}).join('')+'<button class="bt bo bf" style="margin-top:12px" onclick="toast(\'Bient√¥t disponible\')">+ Ajouter demande</button>');}

function oNewCl(){oS('<div class="sht">Nouveau client</div><div class="ig"><label class="il">Email</label><input class="ip" type="email" placeholder="email@exemple.com"></div><div class="ig"><label class="il">T√©l√©phone</label><input class="ip" type="tel" placeholder="06 12 34 56 78"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div class="ig"><label class="il">Pr√©nom</label><input class="ip"></div><div class="ig"><label class="il">Nom</label><input class="ip"></div></div><div class="ig"><label class="il">Adresse</label><input class="ip" placeholder="Rue, CP, Ville"></div><div class="ig"><label class="il">Antenne</label><select class="ip sl"><option>Paris</option><option>Toulouse</option><option>Reims</option><option>Le Havre</option><option>Dijon</option><option>Menton</option><option>Nancy</option></select></div><div class="dv"></div><div style="font-weight:600;margin-bottom:12px">Enfant</div><div class="ig"><label class="il">Pr√©nom</label><input class="ip"></div><div class="ig"><label class="il">Classe</label><select class="ip sl"><option>CP</option><option>CE1</option><option>CE2</option><option>CM1</option><option>CM2</option><option>6e</option><option>5e</option><option>4e</option><option>3e</option><option>Seconde</option><option>Premi√®re</option><option>Terminale</option></select></div><div class="ig"><label class="il">Mati√®res</label><input class="ip" placeholder="Maths, Fran√ßais..."></div><div class="ig"><label class="il">Volume</label><select class="ip sl"><option>1h/sem</option><option>2h/sem</option><option>3h/sem</option><option>4h/sem</option><option>5h+/sem</option></select></div><div class="ig"><label class="il">Dispos</label><textarea class="ip"></textarea></div><div class="ig"><label class="il">Infos</label><textarea class="ip"></textarea></div><button class="bt bp bf" onclick="cS();toast(\'‚úÖ Client cr√©√© et annonce publi√©e\')">Cr√©er et publier</button>');}

function oRefDem(id){var d=D.dm.find(x=>x.id===id),p=d.pi?D.p.find(x=>x.id===d.pi):null,c2=D.ca.filter(c=>c.di===id);oS('<div class="sht">'+d.st+' ‚Äî '+d.lv+'</div><div class="dg"><div class="di df"><div class="dll">Mati√®res</div><div class="dvv">'+d.su.join(', ')+'</div></div><div class="di"><div class="dll">Fr√©quence</div><div class="dvv">'+d.fr+'</div></div><div class="di"><div class="dll">Depuis</div><div class="dvv">'+d.si+'</div></div><div class="di df"><div class="dll">Dispos</div><div class="dvv">'+d.di+'</div></div>'+(p?'<div class="di df"><div class="dll">Parent</div><div class="dvv">'+p.fn+' '+p.ln+' ‚Äî '+p.te+'</div></div>':'')+'</div><div class="st">Candidatures ('+c2.length+')</div>'+(c2.length?c2.map(c=>{var t=D.t.find(x=>x.id===c.ti);return '<div class="cd cc" onclick="cS();setTimeout(function(){oCandR(\''+c.id+'\')},250)"><div style="font-weight:600">'+(t?t.fn+' '+t.ln:'')+'</div></div>';}).join(''):'<div style="text-align:center;padding:20px;color:var(--t3)">Pas encore de candidature</div>'));}

function oContact(){oS('<div class="sht">Contacter l\'√©quipe</div><p style="font-size:13px;color:var(--t2);margin-bottom:14px">Question, probl√®me ? On vous r√©pond rapidement.</p><div class="cd cc" onclick="toast(\'Ouverture WhatsApp...\')"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:24px">üí¨</span><div><div style="font-weight:600">WhatsApp</div><div style="font-size:12px;color:var(--t3)">R√©ponse rapide</div></div></div></div><div class="cd cc" onclick="toast(\'Ouverture mail...\')"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:24px">üìß</span><div><div style="font-weight:600">Email</div><div style="font-size:12px;color:var(--t3)">contact@sciencespistes.fr</div></div></div></div><div class="cd cc" onclick="toast(\'Centre d\\\'aide...\')"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:24px">üìñ</span><div><div style="font-weight:600">Centre d\'aide</div><div style="font-size:12px;color:var(--t3)">FAQ, guides</div></div></div></div>');}

function ePro(){var t=U;oS('<div class="sht">Modifier mon profil</div><div class="ig"><label class="il">T√©l√©phone</label><input class="ip" value="'+t.te+'"></div><div class="ig"><label class="il">Adresse</label><input class="ip" value="'+t.ad+'"></div><div class="ig"><label class="il">SIRET</label><input class="ip" value="'+(t.si||'')+'" placeholder="Ton num√©ro SIRET"></div><div class="ig"><label class="il">Mati√®res</label><input class="ip" value="'+t.su.join(', ')+'"></div><div class="ig"><label class="il">Pr√©sentation</label><textarea class="ip" style="min-height:100px">'+t.pr+'</textarea></div><button class="bt bp bf" onclick="cS();toast(\'‚úÖ Profil mis √† jour\')">Enregistrer</button>');}
function eProP(){oS('<div class="sht">Modifier mes infos</div><div class="ig"><label class="il">T√©l√©phone</label><input class="ip" value="'+U.te+'"></div><div class="ig"><label class="il">Adresse</label><input class="ip" value="'+U.ad+'"></div><button class="bt bp bf" onclick="cS();toast(\'‚úÖ Mis √† jour\')">Enregistrer</button>');}

// HELPERS
function pH(u,c){c=c||'co';return '<div style="text-align:center;padding:16px 0 20px;border-bottom:1px solid var(--brd);margin-bottom:16px"><div style="width:64px;height:64px;border-radius:50%;background:var(--'+c+');color:#fff;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;margin:0 auto 10px;box-shadow:0 4px 16px rgba(0,0,0,.15)">'+u.ini+'</div><div style="font-family:Newsreader,serif;font-size:20px;font-weight:600">'+u.fn+' '+u.ln+'</div><div style="font-size:13px;color:var(--t3)">'+u.em+'</div></div>';}
function pR(l,v){return '<div class="cd pr"><div class="prl">'+l+'</div><div class="prv">'+v+'</div></div>';}
function gp(a,k){var g={};a.forEach(function(i){var v=i[k];if(!g[v])g[v]=[];g[v].push(i);});return Object.entries(g);}
function fD(d){if(!d)return'';var m=['jan.','f√©v.','mars','avr.','mai','juin','juil.','ao√ªt','sept.','oct.','nov.','d√©c.'];var p=d.split('-');return(+p[2])+' '+m[(+p[1])-1]+' '+p[0];}
function toast(m){var t=document.getElementById('to');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2500);}
function ic(n){var i={grid:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>',users:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>',file:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',user:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',home:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',inbox:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/></svg>',book:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>'};return i[n]||'';}

// === Exposition globale des fonctions (requis pour type="module") ===
window.doL = doL;
window.demoL = demoL;
window.doLo = doLo;
window.goTo = goTo;
window.oOnboard = oOnboard;
window.cCB = cCB;
window.cbNext = cbNext;
window.cbClear = cbClear;
window.cbAddMsg = cbAddMsg;
window.sendCBMsg = sendCBMsg;
window.bA = bA;
window.bN = bN;
window.bT = bT;
window.bP = bP;
window.bR = bR;
window.rRC = rRC;
window.fRC = fRC;
window.sPT = sPT;
window.oOffer = oOffer;
window.sApp = sApp;
window.oCandD = oCandD;
window.wCand = wCand;
window.oNewDecl = oNewDecl;
window.oDemP = oDemP;
window.oDclP = oDclP;
window.oNewDemP = oNewDemP;
window.oCandR = oCandR;
window.dC = dC;
window.oClR = oClR;
window.oNewCl = oNewCl;
window.oRefDem = oRefDem;
window.oContact = oContact;
window.ePro = ePro;
window.eProP = eProP;
window.oS = oS;
window.cS = cS;
window.toast = toast;
window.ic = ic;
window.pH = pH;
window.pR = pR;
window.gp = gp;
window.fD = fD;
window.cs = cs;
</script></body></html>
